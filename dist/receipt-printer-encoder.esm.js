"use strict";
var Ce=Object.defineProperty;var oe=p=>{throw TypeError(p)};var Ee=(p,t,e)=>t in p?Ce(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var ae=(p,t,e)=>Ee(p,typeof t!="symbol"?t+"":t,e),G=(p,t,e)=>t.has(p)||oe("Cannot "+e);var n=(p,t,e)=>(G(p,t,"read from private field"),e?e.call(p):t.get(p)),b=(p,t,e)=>t.has(p)?oe("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(p):t.set(p,e),m=(p,t,e,r)=>(G(p,t,"write to private field"),r?r.call(p,e):t.set(p,e),e),E=(p,t,e)=>(G(p,t,"access private method"),e);import U from"canvas-dither";import Te from"canvas-flatten";import re from"@point-of-sale/codepage-encoder";import H from"@canvas/image-data";import Be from"resize-image-data";import J from"@point-of-sale/codepage-encoder";var K=class{initialize(){return[[27,64],[28,46],[27,77,0]]}font(t){return[27,77,t.charCodeAt(0)-65]}align(t){let e;switch(t){case"center":e=1;break;case"right":e=2;break;case"left":default:e=0}return[27,97,e]}barcode(t,e,r){let s=[],i={upca:0,upce:1,ean13:2,ean8:3,code39:4,coda39:4,itf:5,"interleaved-2-of-5":5,"nw-7":6,codabar:6,code93:72,code128:73,"gs1-128":72,"gs1-databar-omni":75,"gs1-databar-truncated":76,"gs1-databar-limited":77,"gs1-databar-expanded":78,"code128-auto":79};if(typeof e=="string"&&typeof i[e]>"u")throw new Error(`Symbology '${e}' not supported by language`);if(r.width<1||r.width>3)throw new Error("Width must be between 1 and 3");let l=r.width+1;e==="itf"&&(l=r.width*2),(e==="gs1-128"||e=="gs1-databar-omni"||e=="gs1-databar-truncated"||e=="gs1-databar-limited"||e=="gs1-databar-expanded")&&(l=r.width),s.push([29,104,r.height],[29,119,l],[29,72,r.text?2:0]),e=="code128"&&!t.startsWith("{")&&(t="{B"+t),e=="gs1-128"&&(console.log("gs1-128",t,t.replace(/[\(\)\*]/g,"")),t=t.replace(/[\(\)\*]/g,""));let a=J.encode(t,"ascii"),d=typeof e=="string"?i[e]:e;return d>64?s.push([29,107,d,a.length,...a]):s.push([29,107,d,...a,0]),s}qrcode(t,e){let r=[];if(typeof e.model=="number"){let a={1:49,2:50};if(e.model in a)r.push([29,40,107,4,0,49,65,a[e.model],0]);else throw new Error("Model must be 1 or 2")}if(typeof e.size!="number")throw new Error("Size must be a number");if(e.size<1||e.size>8)throw new Error("Size must be between 1 and 8");r.push([29,40,107,3,0,49,67,e.size]);let s={l:48,m:49,q:50,h:51};if(e.errorlevel in s)r.push([29,40,107,3,0,49,69,s[e.errorlevel]]);else throw new Error("Error level must be l, m, q or h");let i=J.encode(t,"iso8859-1"),l=i.length+3;return r.push([29,40,107,l&255,l>>8&255,49,80,48,...i]),r.push([29,40,107,3,0,49,81,48]),r}pdf417(t,e){let r=[];if(typeof e.columns!="number")throw new Error("Columns must be a number");if(e.columns!==0&&(e.columns<1||e.columns>30))throw new Error("Columns must be 0, or between 1 and 30");if(r.push([29,40,107,3,0,48,65,e.columns]),typeof e.rows!="number")throw new Error("Rows must be a number");if(e.rows!==0&&(e.rows<3||e.rows>90))throw new Error("Rows must be 0, or between 3 and 90");if(r.push([29,40,107,3,0,48,66,e.rows]),typeof e.width!="number")throw new Error("Width must be a number");if(e.width<2||e.width>8)throw new Error("Width must be between 2 and 8");if(r.push([29,40,107,3,0,48,67,e.width]),typeof e.height!="number")throw new Error("Height must be a number");if(e.height<2||e.height>8)throw new Error("Height must be between 2 and 8");if(r.push([29,40,107,3,0,48,68,e.height]),typeof e.errorlevel!="number")throw new Error("Errorlevel must be a number");if(e.errorlevel<0||e.errorlevel>8)throw new Error("Errorlevel must be between 0 and 8");r.push([29,40,107,4,0,48,69,48,e.errorlevel+48]),r.push([29,40,107,3,0,48,70,e.truncated?1:0]);let s=J.encode(t,"ascii"),i=s.length+3;return r.push([29,40,107,i&255,i>>8&255,48,80,48,...s]),r.push([29,40,107,3,0,48,81,48]),r}image(t,e,r,s){let i=[],l=(h,c)=>h<e&&c<r?t.data[(e*c+h)*4]>0?0:1:0,a=(h,c)=>{let I=[];for(let C=0;C<Math.ceil(c/24);C++){let T=new Uint8Array(h*3);for(let v=0;v<h;v++)for(let S=0;S<3;S++)for(let F=0;F<8;F++)T[v*3+S]|=l(v,C*24+F+8*S)<<7-F;I.push(T)}return I},d=(h,c)=>{let I=new Uint8Array(h*c>>3);for(let C=0;C<c;C++)for(let T=0;T<h;T=T+8)for(let v=0;v<8;v++)I[C*(h>>3)+(T>>3)]|=l(T+v,C)<<7-v;return I};return s=="column"&&(i.push([27,51,36]),a(e,r).forEach(h=>{i.push([27,42,33,e&255,e>>8&255,...h,10])}),i.push([27,50])),s=="raster"&&i.push([29,118,48,0,e>>3&255,e>>3>>8&255,r&255,r>>8&255,...d(e,r)]),i}cut(t){let e=0;return t=="partial"&&(e=1),[29,86,e]}pulse(t,e,r){return typeof t>"u"&&(t=0),typeof e>"u"&&(e=100),typeof r>"u"&&(r=500),e=Math.min(500,Math.round(e/2)),r=Math.min(500,Math.round(r/2)),[27,112,t?1:0,e&255,r&255]}bold(t){let e=0;return t&&(e=1),[27,69,e]}underline(t){let e=0;return t&&(e=1),[27,45,e]}italic(t){let e=0;return t&&(e=1),[27,52,e]}invert(t){let e=0;return t&&(e=1),[29,66,e]}size(t,e){return[29,33,e-1|t-1<<4]}codepage(t){return[27,116,t]}flush(){return[]}},de=K;import Z from"@point-of-sale/codepage-encoder";var _=class{initialize(){return[27,64,24]}font(t){let e;switch(t){case"B":e=1;break;case"C":e=2;break;case"A":default:e=0}return[27,30,70,e]}align(t){let e=0;return t==="center"?e=1:t==="right"&&(e=2),[27,29,97,e]}barcode(t,e,r){let s=[],i={upce:0,upca:1,ean8:2,ean13:3,code39:4,itf:5,"interleaved-2-of-5":5,code128:6,code93:7,"nw-7":8,codabar:8,"gs1-128":9,"gs1-databar-omni":10,"gs1-databar-truncated":11,"gs1-databar-limited":12,"gs1-databar-expanded":13};if(typeof e=="string"&&typeof i[e]>"u")throw new Error(`Symbology '${e}' not supported by language`);if(r.width<1||r.width>3)throw new Error("Width must be between 1 and 3");e==="code128"&&t.startsWith("{")&&(t=t.slice(2));let l=Z.encode(t,"ascii"),a=typeof e=="string"?i[e]:e;return s.push(27,98,a,r.text?2:1,r.width,r.height,...l,30),s}qrcode(t,e){let r=[],s={1:1,2:2};if(e.model in s)r.push([27,29,121,83,48,s[e.model]]);else throw new Error("Model must be 1 or 2");if(typeof e.size!="number")throw new Error("Size must be a number");if(e.size<1||e.size>8)throw new Error("Size must be between 1 and 8");r.push([27,29,121,83,50,e.size]);let i={l:0,m:1,q:2,h:3};if(e.errorlevel in i)r.push([27,29,121,83,49,i[e.errorlevel]]);else throw new Error("Error level must be l, m, q or h");let l=Z.encode(t,"iso8859-1"),a=l.length;return r.push([27,29,121,68,49,0,a&255,a>>8&255,...l]),r.push([27,29,121,80]),r}pdf417(t,e){let r=[];if(typeof e.columns!="number")throw new Error("Columns must be a number");if(e.columns!==0&&(e.columns<1||e.columns>30))throw new Error("Columns must be 0, or between 1 and 30");if(typeof e.rows!="number")throw new Error("Rows must be a number");if(e.rows!==0&&(e.rows<3||e.rows>90))throw new Error("Rows must be 0, or between 3 and 90");if(r.push([27,29,120,83,48,1,e.rows,e.columns]),typeof e.width!="number")throw new Error("Width must be a number");if(e.width<2||e.width>8)throw new Error("Width must be between 2 and 8");if(r.push([27,29,120,83,50,e.width]),typeof e.height!="number")throw new Error("Height must be a number");if(e.height<2||e.height>8)throw new Error("Height must be between 2 and 8");if(r.push([27,29,120,83,51,e.height]),typeof e.errorlevel!="number")throw new Error("Errorlevel must be a number");if(e.errorlevel<0||e.errorlevel>8)throw new Error("Errorlevel must be between 0 and 8");r.push([27,29,120,83,49,e.errorlevel]);let s=Z.encode(t,"ascii"),i=s.length;return r.push([27,29,120,68,i&255,i>>8&255,...s]),r.push([27,29,120,80]),r}image(t,e,r,s){let i=[],l=(a,d)=>typeof t.data[(e*d+a)*4]>"u"||t.data[(e*d+a)*4]>0?0:1;i.push([27,48]);for(let a=0;a<r/24;a++){let d=a*24,h=new Uint8Array(e*3);for(let c=0;c<e;c++){let I=c*3;h[I]=l(c,d+0)<<7|l(c,d+1)<<6|l(c,d+2)<<5|l(c,d+3)<<4|l(c,d+4)<<3|l(c,d+5)<<2|l(c,d+6)<<1|l(c,d+7),h[I+1]=l(c,d+8)<<7|l(c,d+9)<<6|l(c,d+10)<<5|l(c,d+11)<<4|l(c,d+12)<<3|l(c,d+13)<<2|l(c,d+14)<<1|l(c,d+15),h[I+2]=l(c,d+16)<<7|l(c,d+17)<<6|l(c,d+18)<<5|l(c,d+19)<<4|l(c,d+20)<<3|l(c,d+21)<<2|l(c,d+22)<<1|l(c,d+23)}i.push([27,88,e&255,e>>8&255,...h,10,13])}return i.push([27,122,1]),i}cut(t){let e=0;return t=="partial"&&(e=1),[27,100,e]}pulse(t,e,r){return typeof t>"u"&&(t=0),typeof e>"u"&&(e=200),typeof r>"u"&&(r=200),e=Math.min(127,Math.round(e/10)),r=Math.min(127,Math.round(r/10)),[27,7,e&255,r&255,t?26:7]}bold(t){let e=70;return t&&(e=69),[27,e]}underline(t){let e=0;return t&&(e=1),[27,45,e]}italic(t){return[]}invert(t){let e=53;return t&&(e=52),[27,e]}size(t,e){return[27,105,e-1,t-1]}codepage(t){return[27,29,116,t]}flush(){return[[27,29,80,48],[27,29,80,49]]}},ue=_;var D,f,k,ee=class{constructor(t){b(this,D,{bold:!1,italic:!1,underline:!1,invert:!1,width:1,height:1});b(this,f);b(this,k);m(this,f,structuredClone(n(this,D))),m(this,k,t.callback||(()=>{}))}store(){let t=[];for(let e in n(this,f)){let r=e,s=n(this,f)[r],i=n(this,D)[r];s!==i&&(r==="width"||r==="height"?t.push({type:"style",property:"size",value:{width:i,height:i}}):t.push({type:"style",property:r,value:i}))}return t}restore(){let t=[];for(let e in n(this,f)){let r=e,s=n(this,f)[r],i=n(this,D)[r];s!==i&&(r==="width"||r==="height"?t.push({type:"style",property:"size",value:{width:s,height:s}}):t.push({type:"style",property:r,value:s}))}return t}set bold(t){t!==n(this,f).bold&&(n(this,f).bold=t,n(this,k).call(this,{type:"style",property:"bold",value:t}))}get bold(){return n(this,f).bold}set italic(t){t!==n(this,f).italic&&(n(this,f).italic=t,n(this,k).call(this,{type:"style",property:"italic",value:t}))}get italic(){return n(this,f).italic}set underline(t){t!==n(this,f).underline&&(n(this,f).underline=t,n(this,k).call(this,{type:"style",property:"underline",value:t}))}get underline(){return n(this,f).underline}set invert(t){t!==n(this,f).invert&&(n(this,f).invert=t,n(this,k).call(this,{type:"style",property:"invert",value:t}))}get invert(){return n(this,f).invert}set width(t){t!==n(this,f).width&&(n(this,f).width=t,n(this,k).call(this,{type:"style",property:"size",value:{width:n(this,f).width,height:n(this,f).height}}))}get width(){return n(this,f).width}set height(t){t!==n(this,f).height&&(n(this,f).height=t,n(this,k).call(this,{type:"style",property:"size",value:{width:n(this,f).width,height:n(this,f).height}}))}get height(){return n(this,f).height}};D=new WeakMap,f=new WeakMap,k=new WeakMap;var ce=ee;var te=class{static wrap(t,e){let r=[],s=[],i=e.indent||0,l=e.width||1,a=e.columns||42,d=String(t).split(/\r\n|\n/g);for(let c of d){let I=c.match(/[^\s-]+?-\b|\S+|\s+|\r\n?|\n/g)||["~~empty~~"];for(let C of I){if(C==="~~empty~~"){r.push(s),s=[],i=0;continue}if(i+C.length*l>a){if(C.length*l>a){let T=a-i,v=C.split(""),S,F=[];for(T>8*l&&(S=v.splice(0,Math.floor(T/l)).join(""),s.push(S),r.push(s),s=[],i=0);(S=v.splice(0,Math.floor(a/l))).length;)F.push(S.join(""));for(let Y of F)i+Y.length*l>a&&(r.push(s),s=[],i=0),s.push(Y),i+=Y.length*l;continue}r.push(s),s=[],i=0}C.match(/\s+/)&&i==0||(s.push(C),i+=C.length*l)}s.length>0&&(r.push(s),s=[],i=0)}let h=[];for(let c=0;c<r.length;c++){let I=r[c].join("");c<r.length-1&&(I=I.trimEnd()),h.push(I)}return h}},pe=te;var ze=p=>Array.isArray(p)&&p.length>0&&Array.isArray(p[0]),Ie=p=>p.type==="text",Ae=p=>p.type==="space";var me=p=>p.type==="align",he=p=>p.type==="style";var Q,A,B,W,y,M,x,L,V,ne=class{constructor(t){b(this,L);ae(this,"style");b(this,Q);b(this,A);b(this,B);b(this,W);b(this,y,0);b(this,M);b(this,x,[]);m(this,Q,t.embedded||!1),m(this,A,t.columns||42),m(this,B,t.align||"left"),m(this,W,t.callback||(()=>{})),this.style=new ce({callback:e=>{this.add(e,0)}}),m(this,M,this.style.store())}text(t,e){let r=pe.wrap(t,{columns:n(this,A),width:this.style.width,indent:n(this,y)});for(let s=0;s<r.length;s++)r[s].length?(this.add({type:"text",value:r[s],codepage:e},r[s].length*this.style.width),s<r.length-1&&this.flush()):this.flush({forceNewline:!0})}space(t){this.add({type:"space",size:t},t)}raw(t,e){if(ze(t))for(let r of t)this.add({type:"raw",value:r},e||0);else this.add({type:"raw",value:t},e||0)}add(t,e){e+n(this,y)>n(this,A)&&this.flush(),m(this,y,n(this,y)+e),m(this,x,n(this,x).concat(Array.isArray(t)?t:[t]))}end(){m(this,y,n(this,A))}fetch(t){if(n(this,y)===0&&!t.forceNewline&&!t.forceFlush)return[];let e={current:n(this,B),next:null};for(let l=0;l<n(this,x).length-1;l++){let a=n(this,x)[l];me(a)&&(e.current=a.value)}if(n(this,x).length){let l=n(this,x)[n(this,x).length-1];l.type==="align"&&(e.next=l.value)}m(this,B,e.current);let r=[],s=this.style.restore(),i=this.style.store();if(n(this,y)===0&&t.ignoreAlignment)r=E(this,L,V).call(this,[...n(this,M),...n(this,x),...i]);else{if(n(this,B)==="right"){let l;for(let a=n(this,x).length-1;a>=0;a--)if(n(this,x)[a].type==="text"||n(this,x)[a].type==="space"){l=a;break}if(typeof l=="number"){let a=n(this,x)[l];Ae(a)&&a.size>this.style.width&&(a.size-=this.style.width,m(this,y,n(this,y)-this.style.width)),Ie(a)&&a.value.endsWith(" ")&&(a.value=a.value.slice(0,-1),m(this,y,n(this,y)-this.style.width))}r=E(this,L,V).call(this,[{type:"space",size:n(this,A)-n(this,y)},...n(this,M),...n(this,x),...i])}if(n(this,B)==="center"){let l=n(this,A)-n(this,y)>>1;r=E(this,L,V).call(this,[{type:"space",size:l},...n(this,M),...n(this,x),...i,{type:"space",size:n(this,Q)?n(this,A)-n(this,y)-l:0}])}n(this,B)==="left"&&(r=E(this,L,V).call(this,[...n(this,M),...n(this,x),...i,{type:"space",size:n(this,Q)?n(this,A)-n(this,y):0}]))}return m(this,M,s),m(this,x,[]),m(this,y,0),r.length===0&&t.forceNewline&&r.push({type:"empty"}),e.next&&m(this,B,e.next),r}flush(t){t=Object.assign({forceNewline:!1,forceFlush:!1,ignoreAlignment:!1},t||{});let e=this.fetch(t);e.length&&n(this,W).call(this,e)}get cursor(){return n(this,y)}set align(t){this.add({type:"align",value:t},0)}get align(){let t=n(this,B);for(let e=0;e<n(this,x).length;e++){let r=n(this,x)[e];me(r)&&(t=r.value)}return t}set columns(t){m(this,A,t)}get columns(){return n(this,A)}};Q=new WeakMap,A=new WeakMap,B=new WeakMap,W=new WeakMap,y=new WeakMap,M=new WeakMap,x=new WeakMap,L=new WeakSet,V=function(t){let e=[],r=-1;function s(i){return i.type==="text"}for(let i of t)if(i.type==="space"&&"size"in i&&i.size>0&&(i={type:"text",value:" ".repeat(i.size),codepage:null}),s(i)){let l=e[r];if(r>=0&&s(l)&&(l.codepage===i.codepage||l.codepage===null||i.codepage===null)){l.value+=i.value,l.codepage=l.codepage||i.codepage;continue}e.push(i),r++}else if(he(i)&&i.property==="size"){let l=e[r];if(r>=0&&he(l)&&l.property==="size"){l.value=i.value;continue}e.push(i),r++}else(i.type==="style"||i.type==="raw")&&(e.push(i),r++);return e};var fe=ne;var ve={"esc-pos":{"bixolon/legacy":["cp437","epson/katakana","cp850","cp860","cp863","cp865",null,null,null,null,null,null,null,null,null,null,null,null,null,"cp858"],bixolon:["cp437","epson/katakana","cp850","cp860","cp863","cp865",null,null,null,null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858",null,"cp862","cp864","thai42","windows1253","windows1254","windows1257",null,"windows1251","cp737","cp775","thai14","bixolon/hebrew","windows1255","thai11","thai18","cp885","cp857","iso8859-7","thai16","windows1256","windows1258","khmer",null,null,null,"bixolon/cp866","windows1250",null,"tcvn3","tcvn3capitals","viscii"],citizen:["cp437","epson/katakana","cp858","cp860","cp863","cp865","cp852","cp866","cp857",null,null,null,null,null,null,null,"windows1252",null,null,null,null,"thai11",null,null,null,null,"thai13",null,null,null,"tcvn3","tcvn3capitals","windows1258",null,null,null,null,null,null,null,"cp864"],"epson/legacy":["cp437","epson/katakana","cp850","cp860","cp863","cp865",null,null,null,null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858"],epson:["cp437","epson/katakana","cp850","cp860","cp863","cp865",null,null,null,null,null,"cp851","cp853","cp857","cp737","iso8859-7","windows1252","cp866","cp852","cp858","thai42","thai11",null,null,null,null,"thai13",null,null,null,"tcvn3","tcvn3capitals","cp720","cp775","cp855","cp861","cp862","cp864","cp869","epson/iso8859-2","iso8859-15","cp1098","cp774","cp772","cp1125","windows1250","windows1251","windows1253","windows1254","windows1255","windows1256","windows1257","windows1258","rk1048"],fujitsu:["cp437","epson/katakana","cp850","cp860","cp863","cp865",null,null,"cp857",null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858",null,null,null,null,null,null,"thai13",null,null,null,null,null,null,null,null,null,null,null,null,null,"cp864"],hp:["cp437","cp850","cp852","cp860","cp863","cp865","cp858","cp866","windows1252","cp862","cp737","cp874","cp857","windows1251","windows1255","rk1048"],metapace:["cp437","epson/katakana","cp850","cp860","cp863","cp865",null,null,null,null,null,null,null,null,null,null,null,null,null,"cp858"],mpt:["cp437",null,"cp850","cp860","cp863","cp865","windows1251","cp866","cp3021","cp3012"],"pos-5890":["cp437","epson/katakana","cp850","cp860","cp863","cp865","iso8859-1",null,"cp862",null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858",null,null,null,"windows1251","cp737","windows1257",null,"windows1258","cp864",null,null,null,"windows1255",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"cp861",null,null,null,"cp855","cp857",null,null,null,"cp851","cp869",null,"cp772","cp774",null,null,"windows1250",null,"cp3840",null,"cp3843","cp3844","cp3845","cp3846","cp3847","cp3848",null,"cp771","cp3001","cp3002","cp3011","cp3012",null,"cp3041","windows1253","windows1254","windows1256","cp720",null,"cp775"],"pos-8360":["cp437","epson/katakana","cp850","cp860","cp863","cp865","iso8859-1","windows1253","cp862",null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858",null,"latvian",null,"windows1251","cp737","windows1257",null,"windows1258","cp864",null,null,"pos8360/hebrew","windows1255",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"cp861",null,null,null,"cp855","cp857",null,null,null,"cp851","cp869",null,"cp772","cp774",null,null,"windows1250",null,"cp3840",null,"cp3843","cp3844","cp3845","cp3846","cp3847","cp3848",null,"cp771","cp3001","cp3002","cp3011","cp3012",null,null,null,"windows1254","windows1256","cp720",null,"cp775"],star:["cp437","star/katakana","cp850","cp860","cp863","cp865",null,null,null,null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858","thai42","thai11","thai13","thai14","thai16",null,"thai18"],xprinter:["cp437","epson/katakana","cp850","cp860","cp863","cp865","iso8859-1","windows1253","xprinter/hebrew","cp3012",null,"windows1255",null,null,null,null,"windows1252","cp866","cp852","cp858",null,"latvian","cp864","windows1251","cp737","windows1257",null,null,null,null,null,null,null,"windows1256"],youku:["cp437","epson/katakana","cp850","cp860","cp863","cp865","windows1251","cp866","cp3021","cp3012",null,null,null,null,null,"cp862","windows1252",null,"cp852","cp858",null,null,"cp864","iso8859-1","cp737","windows1257",null,null,"cp855","cp857","windows1250","cp775","windows1254","windows1255","windows1256","windows1258",null,null,"iso8859-1",null,null,null,null,null,"iso8859-15",null,null,"cp874"],zijang:["cp437","epson/katakana","cp850","cp860","cp863","cp865","iso8859-1",null,"cp862",null,null,null,null,null,null,null,"windows1252","cp866","cp852","cp858",null,null,null,"windows1251","cp737","windows1257",null,"windows1258","cp864",null,null,null,"windows1255",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"cp861",null,null,null,"cp855","cp857",null,null,null,"cp851","cp869",null,"cp772","cp774",null,null,"windows1250",null,"cp3840",null,"cp3843","cp3844","cp3845","cp3846","cp3847","cp3848",null,"cp771","cp3001","cp3002","cp3011","cp3012",null,"cp3041","windows1253","windows1254","windows1256","cp720",null,"cp775"]},"star-prnt":{star:["star/standard","cp437","star/katakana",null,"cp858","cp852","cp860","cp861","cp863","cp865","cp866","cp855","cp857","cp862","cp864","cp737","cp851","cp869","star/cp928","cp772","cp774","star/cp874",null,null,null,null,null,null,null,null,null,null,"windows1252","windows1250","windows1251",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"cp3840","cp3841","cp3843","cp3844","cp3845","cp3846","cp3847","cp3848","cp1001","cp771","cp3001","cp3002","cp3011","cp3012","cp3021","cp3041"]},"star-line":{star:["star/standard","cp437","star/katakana",null,"cp858","cp852","cp860","cp861","cp863","cp865","cp866","cp855","cp857","cp862","cp864","cp737","cp851","cp869","star/cp928","cp772","cp774","star/cp874",null,null,null,null,null,null,null,null,null,null,"windows1252","windows1250","windows1251",null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,"cp3840","cp3841","cp3843","cp3844","cp3845","cp3846","cp3847","cp3848","cp1001","cp771","cp3001","cp3002","cp3011","cp3012","cp3021","cp3041"]}},ge=ve;var Pe={"bixolon-srp350":{vendor:"Bixolon",model:"SRP-350",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"bixolon/legacy",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!1,models:[]},pdf417:{supported:!1},cutter:{feed:4}}},"bixolon-srp350iii":{vendor:"Bixolon",model:"SRP-350III",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"bixolon",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56},C:{size:"9x24",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!0},cutter:{feed:4}}},"citizen-ct-s310ii":{vendor:"Citizen",model:"CT-S310II",media:{dpi:203,width:80},capabilities:{language:"esc-pos",codepages:"citizen",fonts:{A:{size:"12x24",columns:48},B:{size:"9x24",columns:64},C:{size:"8x16",columns:72}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:3}}},"epson-tm-p20ii":{vendor:"Epson",model:"TM-P20II",media:{dpi:203,width:58},capabilities:{language:"esc-pos",codepages:"epson",fonts:{A:{size:"12x24",columns:32},B:{size:"9x24",columns:42},C:{size:"9x17",columns:42},D:{size:"10x24",columns:38},E:{size:"8x16",columns:48}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded","code128-auto"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},images:{mode:"raster"},cutter:{feed:3}}},"epson-tm-t20iii":{vendor:"Epson",model:"TM-T20III",interfaces:{usb:{productName:"TM-T20III"}},media:{dpi:203,width:80},capabilities:{language:"esc-pos",codepages:"epson",fonts:{A:{size:"12x24",columns:48},B:{size:"9x17",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"epson-tm-t70":{vendor:"Epson",model:"TM-T70",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson/legacy",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},images:{mode:"raster"},cutter:{feed:4}}},"epson-tm-t70ii":{vendor:"Epson",model:"TM-T70II",interface:{usb:{productName:"TM-T70II"}},media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},images:{mode:"raster"},cutter:{feed:4}}},"epson-tm-t88ii":{vendor:"Epson",model:"TM-T88II",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson/legacy",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"epson-tm-t88iii":{vendor:"Epson",model:"TM-T88III",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson/legacy",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"epson-tm-t88iv":{vendor:"Epson",model:"TM-T88IV",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson/legacy",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"epson-tm-t88v":{vendor:"Epson",model:"TM-T88V",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"epson-tm-t88vi":{vendor:"Epson",model:"TM-T88VI",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"epson-tm-t88vii":{vendor:"Epson",model:"TM-T88VII",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"epson",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded","code128-auto"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:4}}},"fujitsu-fp1000":{vendor:"Fujitsu",model:"FP-1000",media:{dpi:203,width:80},capabilities:{language:"esc-pos",codepages:"fujitsu",fonts:{A:{size:"12x24",columns:48},B:{size:"9x24",columns:56},C:{size:"8x16",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!1},cutter:{feed:4}}},"hp-a779":{vendor:"HP",model:"A779",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"hp",newline:`
`,fonts:{A:{size:"12x24",columns:44}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!1,fallback:{type:"barcode",symbology:75}},cutter:{feed:4}}},"metapace-t1":{vendor:"Metapace",model:"T-1",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"metapace",fonts:{A:{size:"12x24",columns:42},B:{size:"9x17",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!1,models:[]},pdf417:{supported:!1},cutter:{feed:4}}},"mpt-ii":{vendor:"",model:"MPT-II",media:{dpi:180,width:80},capabilities:{language:"esc-pos",codepages:"mpt",fonts:{A:{size:"12x24",columns:48},B:{size:"9x17",columns:64},C:{size:"0x0",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:[]},pdf417:{supported:!1}}},"pos-5890":{vendor:"",model:"POS-5890",media:{dpi:203,width:58},capabilities:{language:"esc-pos",codepages:"pos-5890",fonts:{A:{size:"12x24",columns:32},B:{size:"9x17",columns:42}},barcodes:{supported:!0,symbologies:["upca","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!0},images:{mode:"raster"},cutter:{feed:1}}},"pos-8360":{vendor:"",model:"POS-8360",media:{dpi:203,width:80},capabilities:{language:"esc-pos",codepages:"pos-8360",fonts:{A:{size:"12x24",columns:48},B:{size:"9x17",columns:64}},barcodes:{supported:!0,symbologies:["upca","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!0},images:{mode:"raster"},cutter:{feed:4}}},"star-mc-print2":{vendor:"Star",model:"mC-Print2",interfaces:{usb:{productName:"mC-Print2"}},media:{dpi:203,width:58},capabilities:{language:"star-prnt",codepages:"star",fonts:{A:{size:"12x24",columns:32},B:{size:"9x24",columns:42}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","itf","codabar","code93","code128","gs1-128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:3}}},"star-mpop":{vendor:"Star",model:"mPOP",interfaces:{usb:{productName:"mPOP"}},media:{dpi:203,width:58},capabilities:{language:"star-prnt",codepages:"star",fonts:{A:{size:"12x24",columns:32},B:{size:"9x24",columns:42}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","itf","codabar","code93","code128","gs1-128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:3}}},"star-sm-l200":{vendor:"Star",model:"SM-L200",media:{dpi:203,width:58},capabilities:{language:"star-prnt",codepages:"star",fonts:{A:{size:"12x24",columns:32},B:{size:"9x24",columns:42},C:{size:"9x17",columns:42}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!0}}},"star-tsp100iii":{vendor:"Star",model:"TSP100III",media:{dpi:203,width:80},capabilities:{language:"star-prnt",codepages:"star",fonts:{A:{size:"12x24",columns:48},B:{size:"9x24",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:3}}},"star-tsp100iv":{vendor:"Star",model:"TSP100IV",media:{dpi:203,width:80},capabilities:{language:"star-prnt",codepages:"star",fonts:{A:{size:"12x24",columns:48},B:{size:"9x24",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:3}}},"star-tsp650":{vendor:"Star",model:"TSP650",media:{dpi:203,width:80},capabilities:{language:"star-line",codepages:"star",fonts:{A:{size:"12x24",columns:48},B:{size:"9x24",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!1,models:[]},pdf417:{supported:!1},cutter:{feed:3}}},"star-tsp650ii":{vendor:"Star",model:"TSP650II",media:{dpi:203,width:80},capabilities:{language:"star-line",codepages:"star",fonts:{A:{size:"12x24",columns:48},B:{size:"9x24",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0},cutter:{feed:3}}},"xprinter-xp-n160ii":{vendor:"Xprinter",model:"XP-N160II",interfaces:{usb:{productName:"Printer-80\0"}},media:{dpi:203,width:80},capabilities:{language:"esc-pos",codepages:"xprinter",fonts:{A:{size:"12x24",columns:48},B:{size:"9x17",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!0},cutter:{feed:4}}},"xprinter-xp-t80q":{vendor:"Xprinter",model:"XP-T80Q",media:{dpi:203,width:80},capabilities:{language:"esc-pos",codepages:"xprinter",fonts:{A:{size:"12x24",columns:48},B:{size:"9x17",columns:64}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!0},cutter:{feed:4}}},"youku-58t":{vendor:"Youku",model:"58T",media:{dpi:203,width:58},capabilities:{language:"esc-pos",codepages:"youku",fonts:{A:{size:"12x24",columns:32},B:{size:"9x24",columns:42}},barcodes:{supported:!0,symbologies:["upca","ean13","ean8","code39","itf","codabar","code93","code128"]},qrcode:{supported:!0,models:["2"]},pdf417:{supported:!1}}}},be=Pe;var se=be,xe=ge,X={columns:42,language:"esc-pos",imageMode:"column",feedBeforeCut:0,newline:`
\r`,codepageMapping:"epson",debug:!1,embedded:!1,createCanvas:null,errors:"relaxed"},u,q,g,o,w,P,N,O,R,z,le,we,ye,j,$=class ${constructor(t){b(this,z);b(this,u,X);b(this,q,[]);b(this,g);b(this,o);b(this,w,{language:X.language,codepages:X.codepageMapping,fonts:{A:{size:"12x24",columns:42},B:{size:"9x24",columns:56}},barcodes:{supported:!0,symbologies:["upca","upce","ean13","ean8","code39","itf","codabar","code93","code128","gs1-databar-omni","gs1-databar-truncated","gs1-databar-limited","gs1-databar-expanded"]},qrcode:{supported:!0,models:["1","2"]},pdf417:{supported:!0}});b(this,P);b(this,N);b(this,O,"cp437");b(this,R,{codepage:0,font:"A"});t=t||{};let e={...X};if(typeof t.language=="string"&&(e.columns=t.language==="esc-pos"?42:48,e.codepageMapping=t.language==="esc-pos"?"epson":"star"),typeof t.printerModel=="string"){if(typeof se[t.printerModel]>"u")throw new Error("Unknown printer model");m(this,w,se[t.printerModel].capabilities),e.columns=n(this,w).fonts.A.columns,e.language=n(this,w).language,e.codepageMapping=n(this,w).codepages||e.codepageMapping,e.newline=n(this,w)?.newline||e.newline,e.feedBeforeCut=n(this,w)?.cutter?.feed||e.feedBeforeCut,e.imageMode=n(this,w)?.images?.mode||e.imageMode}if(t&&m(this,u,Object.assign(e,t)),n(this,u).width&&(n(this,u).columns=n(this,u).width),n(this,u).language==="esc-pos")m(this,g,new de);else if(n(this,u).language==="star-prnt"||n(this,u).language==="star-line")m(this,g,new ue);else throw new Error("The specified language is not supported");if(typeof n(this,u).autoFlush>"u"&&(n(this,u).autoFlush=!n(this,u).embedded&&n(this,u).language=="star-prnt"),![32,35,42,44,48].includes(n(this,u).columns)&&!n(this,u).embedded)throw new Error("The width of the paper must me either 32, 35, 42, 44 or 48 columns");if(typeof n(this,u).codepageMapping=="string"){if(typeof xe[n(this,u).language][n(this,u).codepageMapping]>"u")throw new Error("Unknown codepage mapping");m(this,P,Object.fromEntries(xe[n(this,u).language][n(this,u).codepageMapping].map((r,s)=>[r,s]).filter(r=>r)))}else m(this,P,n(this,u).codepageMapping);n(this,u).codepageCandidates?m(this,N,n(this,u).codepageCandidates):m(this,N,Object.keys(n(this,P))),m(this,o,new fe({embedded:n(this,u).embedded,columns:n(this,u).columns,align:"left",callback:r=>n(this,q).push(r)})),E(this,z,le).call(this)}initialize(){if(n(this,u).embedded)throw new Error("Initialize is not supported in table cells or boxes");return n(this,o).raw(n(this,g).initialize()),this}codepage(t){if(t==="auto")return m(this,O,t),this;if(!re.supports(t))throw new Error("Unknown codepage");if(typeof n(this,P)[t]<"u")m(this,O,t);else throw new Error("Codepage not supported by printer");return this}text(t){return n(this,o).text(t,n(this,O)),this}newline(t=1){typeof t=="string"&&(t=parseInt(t,10)||1);for(let e=0;e<t;e++)n(this,o).flush({forceNewline:!0});return this}line(t){return this.text(t),this.newline(),this}underline(t){return typeof t>"u"?n(this,o).style.underline=!n(this,o).style.underline:n(this,o).style.underline=t,this}italic(t){return typeof t>"u"?n(this,o).style.italic=!n(this,o).style.italic:n(this,o).style.italic=t,this}bold(t){return typeof t>"u"?n(this,o).style.bold=!n(this,o).style.bold:n(this,o).style.bold=t,this}invert(t){return typeof t>"u"?n(this,o).style.invert=!n(this,o).style.invert:n(this,o).style.invert=t,this}width(t){if(typeof t>"u"&&(t=1),typeof t!="number")throw new Error("Width must be a number");if(t<1||t>8)throw new Error("Width must be between 1 and 8");return n(this,o).style.width=t,this}height(t){if(typeof t>"u"&&(t=1),typeof t!="number")throw new Error("Height must be a number");if(t<1||t>8)throw new Error("Height must be between 1 and 8");return n(this,o).style.height=t,this}size(t,e){return typeof t=="string"?this.font(t==="small"?"B":"A"):(typeof e>"u"&&(e=t),this.width(t),this.height(e),this)}font(t){if(n(this,u).embedded)throw new Error("Changing fonts is not supported in table cells or boxes");if(n(this,o).cursor>0)throw new Error("Changing fonts is not supported in the middle of a line");let e,r=t.match(/^[0-9]+x[0-9]+$/);r&&(e=Object.entries(n(this,w).fonts).find(i=>i[1].size==r[0])?.[0]),e=e?.toUpperCase()||"A";let s=n(this,w).fonts[e];return s?(n(this,o).raw(n(this,g).font(e)),n(this,R).font=e,e==="A"?n(this,o).columns=n(this,u).columns:n(this,o).columns=n(this,u).columns/n(this,w).fonts.A.columns*s.columns,this):E(this,z,j).call(this,"This font is not supported by this printer","relaxed")}align(t){if(!["left","center","right"].includes(t))throw new Error("Unknown alignment");return n(this,o).align=t,this}table(t,e){n(this,o).flush();for(let r=0;r<e.length;r++){let s=[],i=0;for(let l=0;l<t.length;l++){let a=new $(Object.assign({},n(this,u),{width:t[l].width,embedded:!0})),d=e[r][l];a.codepage(n(this,O)),a.align(t[l].align),typeof d=="string"&&a.text(d),typeof d=="function"&&d(a);let h=a.commands();i=Math.max(i,h.length),s[l]=h}for(let l=0;l<t.length;l++)if(!(s[l].length>=i))for(let a=s[l].length;a<i;a++){let d="top";typeof t[l].verticalAlign<"u"&&(d=t[l].verticalAlign);let h={commands:[{type:"space",size:t[l].width}],height:1};d=="bottom"?s[l].unshift(h):s[l].push(h)}for(let l=0;l<i;l++){for(let a=0;a<t.length;a++)typeof t[a].marginLeft<"u"&&n(this,o).space(t[a].marginLeft||0),n(this,o).add(s[a][l].commands,t[a].width),typeof t[a].marginRight<"u"&&n(this,o).space(t[a].marginRight||0);n(this,o).flush()}}return this}rule(t){let r={...{style:"single",width:n(this,u).columns||10},...t};return n(this,o).flush(),n(this,o).text((r.style==="double"?"\u2550":"\u2500").repeat(r.width),"cp437"),n(this,o).flush(),this}box(t,e){let s={...{style:"single",align:"left",width:n(this,u).columns,marginLeft:0,marginRight:0,paddingLeft:0,paddingRight:0},...t};if(s.width+s.marginLeft+s.marginRight>n(this,u).columns)throw new Error("Box is too wide");let i=[];s.style=="single"?i=["\u250C","\u2510","\u2514","\u2518","\u2500","\u2502"]:s.style=="double"&&(i=["\u2554","\u2557","\u255A","\u255D","\u2550","\u2551"]);let l=new $(Object.assign({},n(this,u),{width:s.width-(s.style=="none"?0:2)-s.paddingLeft-s.paddingRight,embedded:!0}));l.codepage(n(this,O)),l.align(s.align),typeof e=="function"&&e(l),typeof e=="string"&&l.text(e);let a=l.commands();n(this,o).flush(),s.style!="none"&&(n(this,o).space(s.marginLeft),n(this,o).text(i[0],"cp437"),n(this,o).text(i[4].repeat(s.width-2),"cp437"),n(this,o).text(i[1],"cp437"),n(this,o).space(s.marginRight),n(this,o).flush());for(let d=0;d<a.length;d++)n(this,o).space(s.marginLeft),s.style!="none"&&(n(this,o).style.height=a[d].height,n(this,o).text(i[5],"cp437"),n(this,o).style.height=1),n(this,o).space(s.paddingLeft),n(this,o).add(a[d].commands,s.width-(s.style=="none"?0:2)-s.paddingLeft-s.paddingRight),n(this,o).space(s.paddingRight),s.style!="none"&&(n(this,o).style.height=a[d].height,n(this,o).text(i[5],"cp437"),n(this,o).style.height=1),n(this,o).space(s.marginRight),n(this,o).flush();return s.style!="none"&&(n(this,o).space(s.marginLeft),n(this,o).text(i[2],"cp437"),n(this,o).text(i[4].repeat(s.width-2),"cp437"),n(this,o).text(i[3],"cp437"),n(this,o).space(s.marginRight),n(this,o).flush()),this}barcode(t,e,r){let s={height:60,width:2,text:!1};if(typeof r=="object"&&(s=Object.assign(s,r)),typeof r=="number"&&(s.height=r),n(this,u).embedded)throw new Error("Barcodes are not supported in table cells or boxes");return n(this,w).barcodes.supported===!1?E(this,z,j).call(this,"Barcodes are not supported by this printer","relaxed"):typeof e=="string"&&!n(this,w).barcodes.symbologies.includes(e)?E(this,z,j).call(this,`Symbology '${e}' not supported by this printer`,"relaxed"):(n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align(n(this,o).align)),n(this,o).raw(n(this,g).barcode(t,e,s)),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align("left")),n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),this)}qrcode(t,e,r,s){let i={model:2,size:6,errorlevel:"m"};if(typeof e=="object"&&(i=Object.assign(i,e)),typeof e=="number"&&(i.model=e),typeof r=="number"&&(i.size=r),typeof s=="string"&&(i.errorlevel=s),n(this,u).embedded)throw new Error("QR codes are not supported in table cells or boxes");return n(this,w).qrcode.supported===!1?E(this,z,j).call(this,"QR codes are not supported by this printer","relaxed"):i.model&&!n(this,w).qrcode.models.includes(String(i.model))?E(this,z,j).call(this,"QR code model is not supported by this printer","relaxed"):(n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align(n(this,o).align)),n(this,o).raw(n(this,g).qrcode(t,i)),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align("left")),n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),this)}pdf417(t,e){let s={...{width:3,height:3,columns:0,rows:0,errorlevel:1,truncated:!1},...e};if(n(this,u).embedded)throw new Error("PDF417 codes are not supported in table cells or boxes");return n(this,w).pdf417.supported===!1?typeof n(this,w).pdf417.fallback=="object"?this.barcode(t,n(this,w).pdf417.fallback.symbology):E(this,z,j).call(this,"PDF417 codes are not supported by this printer","relaxed"):(n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align(n(this,o).align)),n(this,o).raw(n(this,g).pdf417(t,s)),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align("left")),n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),this)}image(t,e,r,s,i){if(n(this,u).embedded)throw new Error("Images are not supported in table cells or boxes");if(e%8!==0)throw new Error("Width must be a multiple of 8");if(r%8!==0)throw new Error("Height must be a multiple of 8");typeof s>"u"&&(s="threshold"),typeof i>"u"&&(i=128);let l=t.constructor.name,a;if(l.endsWith("Element")&&(a="element"),l=="ImageData"&&(a="imagedata"),l=="Canvas"&&typeof t.getContext<"u"&&(a="node-canvas"),l=="Image"&&(a="node-canvas-image"),l=="Image"&&typeof t.frames<"u"&&(a="node-read-image"),l=="Object"&&t.data&&t.info&&(a="node-sharp"),l=="View3duint8"&&t.data&&t.shape&&(a="ndarray"),l=="Object"&&t.data&&t.width&&t.height&&(a="object"),!a)throw new Error("Could not determine the type of image input");let d;if(a=="element"){let h=document.createElement("canvas");h.width=e,h.height=r;let c=h.getContext("2d");if(c)c.drawImage(t,0,0,e,r),d=c.getImageData(0,0,e,r);else throw new Error("Failed to get 2D rendering context")}if(a=="node-canvas"&&(d=t.getContext("2d").getImageData(0,0,t.width,t.height)),a=="node-canvas-image"){if(typeof n(this,u).createCanvas!="function")throw new Error("Canvas is not supported in this environment, specify a createCanvas function in the options");let c=n(this,u).createCanvas(e,r).getContext("2d");c.drawImage(t,0,0,e,r),d=c.getImageData(0,0,e,r)}if(a=="node-read-image"&&(d=new H(t.width,t.height),d.data.set(t.frames[0].data)),a=="node-sharp"&&(d=new H(t.info.width,t.info.height),d.data.set(t.data)),a=="ndarray"&&(d=new H(t.shape[0],t.shape[1]),d.data.set(t.data)),a=="object"&&(d=new H(t.width,t.height),d.data.set(t.data)),a=="imagedata"&&(d=t),!d)throw new Error("Image could not be loaded");if((e!==d.width||r!==d.height)&&(d=Be(d,e,r,"bilinear-interpolation")),e!==d.width||r!==d.height)throw new Error("Image could not be resized");switch(d=Te.flatten(d,[255,255,255]),s){case"threshold":d=U.threshold(d,i);break;case"bayer":d=U.bayer(d,i);break;case"floydsteinberg":d=U.floydsteinberg(d);break;case"atkinson":d=U.atkinson(d);break}return n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align(n(this,o).align)),n(this,o).raw(n(this,g).image(d,e,r,n(this,u).imageMode)),n(this,o).align!=="left"&&n(this,o).raw(n(this,g).align("left")),n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),this}cut(t){if(n(this,u).embedded)throw new Error("Cut is not supported in table cells or boxes");for(let e=0;e<n(this,u).feedBeforeCut;e++)n(this,o).flush({forceNewline:!0});return n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),n(this,o).raw(n(this,g).cut(t)),n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),this}pulse(t,e,r){if(n(this,u).embedded)throw new Error("Pulse is not supported in table cells or boxes");return n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),n(this,o).raw(n(this,g).pulse(t,e,r)),n(this,o).flush({forceFlush:!0,ignoreAlignment:!0}),this}raw(t){return n(this,o).raw(t),this}commands(){n(this,u).autoFlush&&!n(this,u).embedded&&n(this,o).raw(n(this,g).flush());let t=[],e=n(this,o).fetch({forceFlush:!0,ignoreAlignment:!0});for(e.length&&n(this,q).push(e);n(this,q).length;){let r=n(this,q).shift(),s=r.filter(i=>i.type==="style"&&i.property==="size").map(i=>i.value.height).reduce((i,l)=>Math.max(i,l),1);n(this,u).debug&&console.log("|"+r.filter(i=>i.type==="text").map(i=>i.value).join("")+"|",s),t.push({commands:r,height:s})}return n(this,u).debug&&console.log("commands",t),E(this,z,le).call(this),t}encode(){let t=this.commands(),e=[];for(let r of t){for(let s of r.commands)s.type==="raw"&&e.push(s.value),s.type==="text"&&e.push(E(this,z,ye).call(this,s.value,s.codepage??"auto")),s.type==="style"&&e.push(E(this,z,we).call(this,s.property,s.value));n(this,u).newline===`
\r`&&e.push([10,13]),n(this,u).newline===`
`&&e.push([10])}return Uint8Array.from(e.flat())}static get printerModels(){return Object.entries(se).map(t=>({id:t[0],name:t[1].vendor+" "+t[1].model}))}get columns(){return n(this,o).columns}get language(){return n(this,u).language}get printerCapabilities(){return n(this,w)}};u=new WeakMap,q=new WeakMap,g=new WeakMap,o=new WeakMap,w=new WeakMap,P=new WeakMap,N=new WeakMap,O=new WeakMap,R=new WeakMap,z=new WeakSet,le=function(){m(this,q,[]),m(this,O,n(this,u).language=="esc-pos"?"cp437":"star/standard"),n(this,R).codepage=0,n(this,R).font="A"},we=function(t,e){return t==="bold"?n(this,g).bold(e):t==="underline"?n(this,g).underline(e):t==="italic"?n(this,g).italic(e):t==="invert"?n(this,g).invert(e):t==="size"?n(this,g).size(e.width,e.height):[]},ye=function(t,e){if(e!=="auto"){let i=re.encode(t,e);return n(this,R).codepage!=n(this,P)[e]?(n(this,R).codepage=n(this,P)[e],[...n(this,g).codepage(n(this,P)[e]),...i]):[...i]}let r=re.autoEncode(t,n(this,N)),s=[];for(let i of r)n(this,R).codepage=n(this,P)[i.codepage],s.push(...n(this,g).codepage(n(this,P)[i.codepage]),...i.bytes);return s},j=function(t,e){if(e==="strict"||n(this,u).errors==="strict")throw new Error(t);return console.warn(t),this};var ie=$,tt=ie;export{tt as default};
//# sourceMappingURL=receipt-printer-encoder.esm.js.map